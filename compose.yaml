services:

  ros2-dev:
    container_name: ros2-dev

    # ðŸ”¥ Soluzione standard: collega Dockerfile al servizio
    build:
      context: .
      dockerfile: Dockerfile

    image: ros2-dev-test:latest

    privileged: true
    network_mode: host
    pid: host
    ipc: host

    environment:
      ROS_AUTOMATIC_DISCOVERY_RANGE: LOCALHOST
      ROS_DOMAIN_ID: "42"
      PS1: "[ROS2-CONTAINER ros2-dev] \\u@\\h:\\w$ "

    volumes:
      - .:/home/ws
      - /dev:/dev
      - /dev/dri:/dev/dri
      - ${HOME}/.ssh:/home/dave/.ssh

    working_dir: /home/ws
    command: ["sleep", "infinity"]


  ros2-dev-gui:
    extends:
      service: ros2-dev

    container_name: ros2-dev-gui

    environment:
      DISPLAY: ${DISPLAY:-":0"}
      PS1: "[ROS2-CONTAINER ros2-dev-gui] \\u@\\h:\\w$ "

    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix

    profiles:
      - gui

